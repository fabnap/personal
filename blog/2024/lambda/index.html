<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="VcyH_ZrXaHdlhrcv5nYDB_2XaDin1d8cwY3birwSNB0"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Lambda function to send an email | Fabrizio Napolitano</title> <meta name="author" content="Fabrizio Napolitano"> <meta name="description" content="How to send use AWS lambda, a demonstration"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon_io/android-chrome-512x512.png?fad440d806eddab97324c8455563352f"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="www.fabrizionapolitano.it/blog/2024/lambda/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Fabrizio Napolitano</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/conf/">conferences</a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">talks</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/thesis/">thesis</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Lambda function to send an email</h1> <p class="post-meta">September 9, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/useful"> <i class="fas fa-hashtag fa-sm"></i> useful</a>     ·   <a href="/blog/category/sample-posts"> <i class="fas fa-tag fa-sm"></i> sample-posts</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Sometimes there are actions which are repetitive and can be automated. For example, looking for job openings in a specific field can be very time consuming. In my country, all public selections ongoing ( at labs or universities ) are published on a specific website, and people check twice per week if there is something new. Unfortunately, the website does not have any filter operations, and you have to scroll down the list of all the selections to see if there is something relevant for you.</p> <p>Relevant <a href="https://xkcd.com/1319/" rel="external nofollow noopener" target="_blank">xkcd</a>.</p> <p>In this post, I will explain how to use AWS’s lambda function to send an email to yourself after parsing the pdf published on a website. For those who are not familiar with AWS, it is a cloud service provider, and lambda is a service that allows you to run code without provisioning or managing servers. Lambda is a serverless computing service, and you can run your code for virtually any type of application or backend service with zero administration.</p> <p>This are the relevant steps:</p> <ul> <li>Get a AWS account; it will be free for the first months</li> <li>Create a lambda function. You can use the AWS console, or the AWS CLI, I did use the console.</li> </ul> <p>For the lambda function, the best is to create a virtual envirnonment with the libraries you need, and then zip it and upload it to the lambda function. This is how it goes:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>my_lambda
<span class="nb">cd </span>my_lambda
python3 <span class="nt">-m</span> venv my_lambda
<span class="nb">source </span>my_lambda/bin/activate
pip <span class="nb">install </span>requests PyPDF2 <span class="c"># the two libraries I need</span>
<span class="nb">cd </span>vev/lib/python3.11/site-packages
</code></pre></div></div> <p>Now, after you have the libraries you can add the <code class="language-plaintext highlighter-rouge">lambda_function.py</code> file, which is the code you want to run. In my case, I want to parse a pdf and send an email if there is a new selection.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">PyPDF2</span> <span class="c1"># for the parsing of the pdf
</span><span class="kn">import</span> <span class="n">boto3</span> <span class="c1"># for the email service
</span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">io</span>

<span class="n">ses</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ses</span><span class="sh">'</span><span class="p">)</span> <span class="c1"># simple email service, needs further configuration on the AWS console
</span>
<span class="c1"># function to send an email
</span><span class="k">def</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="sh">'</span><span class="s">testmail</span><span class="sh">'</span><span class="p">,</span><span class="n">body</span><span class="o">=</span><span class="sh">'</span><span class="s">testmail</span><span class="sh">'</span><span class="p">):</span>

    <span class="n">ses</span><span class="p">.</span><span class="nf">send_email</span><span class="p">(</span>
	    <span class="n">Source</span> <span class="o">=</span> <span class="sh">'</span><span class="s">your@email.com</span><span class="sh">'</span><span class="p">,</span>
	    <span class="n">Destination</span> <span class="o">=</span> <span class="p">{</span>
		    <span class="sh">'</span><span class="s">ToAddresses</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
			    <span class="sh">'</span><span class="s">your@email.com</span><span class="sh">'</span>
		    <span class="p">]</span>
	    <span class="p">},</span>
	    <span class="n">Message</span> <span class="o">=</span> <span class="p">{</span>
		    <span class="sh">'</span><span class="s">Subject</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
			    <span class="sh">'</span><span class="s">Data</span><span class="sh">'</span><span class="p">:</span> <span class="n">subject</span><span class="p">,</span>
			    <span class="sh">'</span><span class="s">Charset</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">UTF-8</span><span class="sh">'</span>
		    <span class="p">},</span>
		    <span class="sh">'</span><span class="s">Body</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
			    <span class="sh">'</span><span class="s">Text</span><span class="sh">'</span><span class="p">:{</span>
				    <span class="sh">'</span><span class="s">Data</span><span class="sh">'</span><span class="p">:</span> <span class="n">body</span><span class="p">,</span>
				    <span class="sh">'</span><span class="s">Charset</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">UTF-8</span><span class="sh">'</span>
			    <span class="p">}</span>
		    <span class="p">}</span>
	    <span class="p">}</span>
    <span class="p">)</span>

<span class="c1"># lets setup some useful functions
</span><span class="k">def</span> <span class="nf">download_pdf</span><span class="p">(</span><span class="n">pdf_url</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">pdf_url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">io</span><span class="p">.</span><span class="nc">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>  <span class="c1"># Return a BytesIO object to avoid saving to disk
</span>
<span class="k">def</span> <span class="nf">extract_text_from_pdf</span><span class="p">(</span><span class="n">pdf_bytes</span><span class="p">):</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="p">.</span><span class="nc">PdfReader</span><span class="p">(</span><span class="n">pdf_bytes</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sh">''</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">.</span><span class="n">pages</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="n">page</span><span class="p">.</span><span class="nf">extract_text</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">text</span>
    
<span class="c1"># i  need this cause the text will be sent per email, and i basically need to format a string
</span><span class="k">def</span> <span class="nf">format_search_results</span><span class="p">(</span><span class="n">search_results</span><span class="p">):</span>
    <span class="n">result_str</span> <span class="o">=</span> <span class="sh">""</span>
    <span class="k">for</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="c1"># Add the keyword and occurrences
</span>        <span class="n">result_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Keyword: </span><span class="sh">'</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="sh">'</span><span class="s">, Occurrences: </span><span class="si">{</span><span class="n">details</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span>
        <span class="n">result_str</span> <span class="o">+=</span> <span class="sh">"</span><span class="s">Snippets:</span><span class="se">\n</span><span class="sh">"</span>
        
        <span class="c1"># Add each snippet with a new line
</span>        <span class="k">for</span> <span class="n">snippet</span> <span class="ow">in</span> <span class="n">details</span><span class="p">[</span><span class="sh">'</span><span class="s">snippets</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">result_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">- </span><span class="si">{</span><span class="n">snippet</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span>
        
        <span class="c1"># Add a newline for better separation between keywords
</span>        <span class="n">result_str</span> <span class="o">+=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span>
    
    <span class="k">return</span> <span class="n">result_str</span>

<span class="c1"># Fixed-date public holidays in Italy. On these dates, the Gazzetta Ufficiale is not published.
</span><span class="k">def</span> <span class="nf">is_fixed_holiday</span><span class="p">(</span><span class="n">date_to_check</span><span class="p">):</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">date_to_check</span><span class="p">.</span><span class="n">year</span>
    <span class="n">fixed_holidays</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>   <span class="c1"># New Year's Day
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>   <span class="c1"># Epiphany
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>  <span class="c1"># Liberation Day
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>   <span class="c1"># Labor Day
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>   <span class="c1"># Republic Day
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>  <span class="c1"># Assumption Day (Ferragosto)
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># All Saints' Day
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>  <span class="c1"># Feast of the Immaculate Conception
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="c1"># Christmas Day
</span>        <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>  <span class="c1"># St. Stephen's Day
</span>    <span class="p">}</span>
    
    <span class="c1"># Check if the date is in the set of fixed holidays
</span>    <span class="k">return</span> <span class="n">date_to_check</span> <span class="ow">in</span> <span class="n">fixed_holidays</span>

<span class="c1"># the function to count the number of tuesdays and fridays from the beginning of the year
# this is needed because the gazzetta number is the sum of the two
</span><span class="k">def</span> <span class="nf">count_fridays_and_tuesdays</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="c1"># Initialize counters
</span>    <span class="n">friday_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tuesday_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Iterate over each date between start_date and end_date
</span>    <span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">if</span> <span class="nf">is_fixed_holiday</span><span class="p">(</span><span class="n">current_date</span><span class="p">):</span> <span class="c1"># Skip fixed holidays
</span>            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">current_date</span><span class="p">.</span><span class="nf">weekday</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Tuesday (weekday() == 1)
</span>            <span class="n">tuesday_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">current_date</span><span class="p">.</span><span class="nf">weekday</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Friday (weekday() == 4)
</span>            <span class="n">friday_count</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Move to the next day
</span>        <span class="n">current_date</span> <span class="o">+=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">friday_count</span><span class="p">,</span> <span class="n">tuesday_count</span>

<span class="c1"># function to search for keywords in the text
</span><span class="k">def</span> <span class="nf">search_keywords</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">snippet_radius</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="c1"># Convert the entire text to lowercase for case-insensitive search
</span>    <span class="n">lower_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
    
    <span class="c1"># Store results for each keyword
</span>    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="c1"># Initialize list to hold snippets for this keyword
</span>        <span class="n">snippets</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Convert keyword to lowercase for case-insensitive search
</span>        <span class="n">lower_keyword</span> <span class="o">=</span> <span class="n">keyword</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>

        <span class="c1"># Find occurrences of the keyword in the text
</span>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c1"># Find the next occurrence of the keyword
</span>            <span class="n">index</span> <span class="o">=</span> <span class="n">lower_text</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">lower_keyword</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># No more occurrences
</span>
            <span class="c1"># Determine snippet boundaries
</span>            <span class="n">start_index</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">snippet_radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="nf">len</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span> <span class="o">+</span> <span class="n">snippet_radius</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

            <span class="c1"># Extract the snippet from the original text (not the lowercase version)
</span>            <span class="n">snippet</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">text</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">[</span><span class="sh">"</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="nf">len</span><span class="p">(</span><span class="n">keyword</span><span class="p">)]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">]</span><span class="sh">"</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="nf">len</span><span class="p">(</span><span class="n">keyword</span><span class="p">):</span><span class="n">end_index</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="n">snippets</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span>

            <span class="c1"># Update start position to continue searching after the current keyword
</span>            <span class="n">start</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="nf">len</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>

        <span class="c1"># Store the snippets and the total count of occurrences for each keyword
</span>        <span class="n">results</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">snippets</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">snippets</span><span class="sh">'</span><span class="p">:</span> <span class="n">snippets</span>
        <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># this is the main function
</span><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># create url for the pdf
</span>    <span class="c1"># get year month day and gazzetta number from the actual date 
</span>    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">date</span><span class="p">.</span><span class="nf">today</span><span class="p">()</span>
    <span class="c1"># today = datetime.date(2024, 9, 3)
</span>    <span class="n">year</span> <span class="o">=</span> <span class="n">today</span><span class="p">.</span><span class="n">year</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">today</span><span class="p">.</span><span class="n">month</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">today</span><span class="p">.</span><span class="n">day</span>

    <span class="c1"># the variable gazzetta, is the number of the gazzetta, counted as the number of tuesdays and friday from the beginning of the year
</span>    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">end_date</span> <span class="o">=</span> <span class="n">today</span>
    <span class="n">friday_count</span><span class="p">,</span> <span class="n">tuesday_count</span> <span class="o">=</span> <span class="nf">count_fridays_and_tuesdays</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="n">gazzetta</span> <span class="o">=</span> <span class="n">friday_count</span> <span class="o">+</span> <span class="n">tuesday_count</span> 

    <span class="c1"># in my case i can alogrithmically create the url. I want the lambda to get the pdf from the correct url at the give time of the month
</span>    <span class="n">pdf_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.gazzettaufficiale.it/do/gazzetta/downloadPdf?dataPubblicazioneGazzetta=</span><span class="sh">'</span> <span class="o">+</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">year</span><span class="si">:</span><span class="mi">04</span><span class="si">}{</span><span class="n">month</span><span class="si">:</span><span class="mi">02</span><span class="si">}{</span><span class="n">day</span><span class="si">:</span><span class="mi">02</span><span class="si">}</span><span class="sh">"</span><span class="o">+</span><span class="sh">'</span><span class="s">&amp;numeroGazzetta=</span><span class="sh">'</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">gazzetta</span><span class="p">)</span><span class="o">+</span><span class="sh">'</span><span class="s">&amp;tipoSerie=S4&amp;tipoSupplemento=GU&amp;numeroSupplemento=0&amp;progressivo=0&amp;estensione=pdf&amp;edizione=0</span><span class="sh">'</span>

    <span class="c1"># the keywords I am looking for
</span>    <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">PHYS-01</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ISTITUTO NAZIONALE DI ASTROFISICA</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ISTUTUTO NAZIONALE DI FISICA NUCLEARE</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">AGENZIA SPAZIALE ITALIANA</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ENEA</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">AGENZIA NAZIONALE PER LE NUOVE TECNOLOGIE</span><span class="sh">'</span><span class="p">]</span>

    <span class="n">response</span> <span class="o">=</span> <span class="sh">''</span>

    <span class="c1"># Download PDF and extract text
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">pdf_bytes</span> <span class="o">=</span> <span class="nf">download_pdf</span><span class="p">(</span><span class="n">pdf_url</span><span class="p">)</span>
        <span class="n">pdf_text</span> <span class="o">=</span> <span class="nf">extract_text_from_pdf</span><span class="p">(</span><span class="n">pdf_bytes</span><span class="p">)</span>

        <span class="c1"># Search keywords
</span>        <span class="n">search_results</span> <span class="o">=</span> <span class="nf">search_keywords</span><span class="p">(</span><span class="n">pdf_text</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>

        <span class="c1"># format the response
</span>        <span class="n">response</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Gazzetta URL: </span><span class="sh">"</span> <span class="o">+</span> <span class="n">pdf_url</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n\n</span><span class="sh">"</span>
        <span class="n">response</span> <span class="o">+=</span> <span class="nf">format_search_results</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span>
        <span class="nf">sendEmail</span><span class="p">(</span><span class="sh">'</span><span class="s">Recap da Gazzetta Ufficiale</span><span class="sh">'</span><span class="p">,</span><span class="n">response</span><span class="p">)</span>

        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">statusCode</span><span class="sh">'</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">body</span><span class="sh">'</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">An error occurred.</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">}</span>
</code></pre></div></div> <p>then you can zip the folder and upload it to the lambda function.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zip <span class="nt">-r</span> my_lambda.zip <span class="nb">.</span>
</code></pre></div></div> <p>and then upload it to the lambda function (in the Code section of lambda).</p> <ul> <li> <p>to create a trigger, you can use a CloudWatch Event, which is a service that allows you to schedule when your lambda function should run. You can create a rule that triggers the lambda function at a specific time or at a specific interval. I want to creat the trigger at 20h00 of every Tuesday and Friday, cause the website is updated on those days. Can use a cron expression to specify the schedule. The cron expression for 20h00 on Tuesday and Friday is <code class="language-plaintext highlighter-rouge">0 20 ? * TUE,FRI *</code>.</p> </li> <li> <p>Finally you have to allow the perimission of the Lambda to use the SES service, which is the email service of AWS. You can do this in the IAM section of the AWS console. Go to IAM -&gt; Policies and create a policy with the following json</p> <div class="language-json highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"ses:SendEmail"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"ses:SendRawEmail"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> <p>also add to your policy AWSLambdaBasicExecutionRole if not there.</p> </li> </ul> <p>Then go to your lambda function, Configuration-&gt;Permissions and attach the policy you just created.</p> <p>This should be it!</p> <p>Now if the function works correctly you will receive an email with the text of the pdf, and you can check if there is something relevant for you.</p> <p>Here is my nice example (the snippets are not very useful in this case, but you get the idea):</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/emailexample-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/emailexample-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/emailexample-1400.webp"></source> <img src="/assets/img/emailexample.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>As a final note, be very careful of the costs of the lambda function, as it can be very expensive if you do not set the correct limits. You can set the limits in the Configuration section of the lambda function. In general it is very inexpensive to run, but be aware that pontially misconfigurations could be very costly.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/gitpages/">Create personal webpages</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/reveal/">Reveal.js presentations</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/typst/">A LaTeX alternative, Typst</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/python_uv/">The successor of pip in python</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/pdfdownload/">PDF viewer in firefox</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Fabrizio Napolitano. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: October 26, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>